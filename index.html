<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è—è¡“ä½œå“ç®¡ç†ç³»çµ± / Artwork Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #fafafa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .user-info {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.2rem;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .auth-container {
            max-width: 400px;
            margin: 50px auto;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-header h2 {
            color: #667eea;
            margin-bottom: 0.5rem;
            font-size: 1.8rem;
        }

        .auth-header p {
            color: #666;
            font-size: 1rem;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 1px solid #eee;
        }

        .auth-tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            border: none;
            background: none;
            color: #666;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            color: #667eea;
            border-bottom: 2px solid #667eea;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .sync-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .sync-indicator.show {
            opacity: 1;
        }

        .sync-indicator.syncing {
            background: #ffc107;
            color: #333;
        }

        .sync-indicator.error {
            background: #dc3545;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .nav-tab {
            flex: 1;
            padding: 1rem;
            border: none;
            background: white;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            border-right: 1px solid #eee;
        }

        .nav-tab:last-child {
            border-right: none;
        }

        .nav-tab.active {
            background: #667eea;
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: #f8f9fa;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-row-triple {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .image-upload {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .image-upload:hover {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .image-upload.drag-over {
            border-color: #667eea;
            background: #e8ecff;
        }

        .image-preview {
            margin-top: 1rem;
            text-align: center;
        }

        .image-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-group {
            position: relative;
            display: inline-block;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 250px;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            display: block;
            width: 100%;
            padding: 0.75rem 1rem;
            border: none;
            background: none;
            text-align: left;
            font-size: 0.9rem;
            color: #333;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border-bottom: 1px solid #f1f1f1;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background-color: #f8f9fa;
        }

        .dropdown-item:focus {
            outline: none;
            background-color: #e9ecef;
        }

        .btn-dropdown {
            position: relative;
            padding-right: 2.5rem;
        }

        .btn-dropdown::after {
            content: 'â–¼';
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8rem;
        }

        .search-filters {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 1rem;
            margin-bottom: 2rem;
            align-items: end;
        }

        .artwork-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .artwork-list {
            display: none;
            margin-top: 2rem;
        }

        .artwork-list.active {
            display: block;
        }

        .artwork-list-item {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: 80px 1fr auto;
            gap: 1rem;
            align-items: center;
            transition: all 0.3s ease;
        }

        .artwork-list-item:hover {
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .artwork-list-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 6px;
            background: #f8f9fa;
        }

        .artwork-list-info {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 1rem;
            align-items: center;
        }

        .artwork-list-detail {
            padding: 0.5rem 0;
        }

        .artwork-list-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.25rem;
        }

        .artwork-list-subtitle {
            font-size: 0.9rem;
            color: #666;
        }

        .view-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .view-controls h2 {
            margin: 0;
        }

        .view-buttons {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .view-btn {
            padding: 0.5rem;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .view-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .view-btn:hover {
            background: #f8f9fa;
        }

        .view-btn.active:hover {
            background: #5a67d8;
        }

        .print-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .print-btn:hover {
            background: #218838;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            
            .print-content, 
            .print-content * {
                visibility: visible;
            }
            
            .print-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            
            .no-print {
                display: none !important;
            }
        }

        .artwork-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .artwork-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .artwork-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #f8f9fa;
        }

        .artwork-info {
            padding: 1.5rem;
        }

        .artwork-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .artwork-artist {
            color: #666;
            margin-bottom: 0.5rem;
        }

        .artwork-details {
            font-size: 0.9rem;
            color: #777;
            margin-bottom: 1rem;
        }

        .artwork-actions {
            display: flex;
            gap: 0.5rem;
        }

        .artwork-actions .btn {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .close {
            font-size: 1.5rem;
            cursor: pointer;
            color: #aaa;
        }

        .close:hover {
            color: #333;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-available {
            background: #d4edda;
            color: #155724;
        }

        .status-sold {
            background: #f8d7da;
            color: #721c24;
        }

        .status-on-hold {
            background: #fff3cd;
            color: #856404;
        }

        .status-exhibition {
            background: #d1ecf1;
            color: #0c5460;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 600;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #28a745;
        }

        .notification.error {
            background: #dc3545;
        }

        .notification.info {
            background: #17a2b8;
        }

        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1002;
        }

        .loading.show {
            display: block;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header {
                padding: 1.5rem 1rem;
                margin-bottom: 1rem;
            }

            .header h1 {
                font-size: 1.8rem;
                line-height: 1.2;
            }

            .header p {
                font-size: 1rem;
            }

            .user-info {
                position: static;
                justify-content: center;
                margin-top: 1rem;
            }

            .nav-tabs {
                flex-direction: column;
                margin-bottom: 1rem;
            }

            .nav-tab {
                border-right: none;
                border-bottom: 1px solid #eee;
                padding: 0.8rem;
                font-size: 0.9rem;
            }

            .nav-tab:last-child {
                border-bottom: none;
            }

            .tab-content {
                padding: 1rem;
            }

            .form-row, .form-row-triple {
                grid-template-columns: 1fr;
                gap: 0.8rem;
            }

            .search-filters {
                grid-template-columns: 1fr;
                gap: 0.8rem;
            }

            .artwork-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .stats {
                grid-template-columns: 1fr 1fr;
                gap: 0.8rem;
            }

            .stat-card {
                padding: 1rem;
            }

            .stat-value {
                font-size: 1.5rem;
            }

            .modal-content {
                width: 95%;
                max-width: none;
                margin: 10px auto;
                padding: 1rem;
                max-height: 95vh;
                overflow-y: auto;
            }

            .modal-header {
                margin-bottom: 1rem;
            }

            .modal-title {
                font-size: 1.2rem;
            }

            .artwork-actions {
                flex-direction: column;
                gap: 0.3rem;
            }

            .artwork-actions .btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
                width: 100%;
            }

            .btn-group {
                width: 100%;
                margin-bottom: 0.8rem;
            }

            .btn-dropdown {
                width: 100%;
                margin-bottom: 0;
            }

            .dropdown-menu {
                left: 0;
                right: 0;
                width: 100%;
                border-radius: 6px;
            }

            .dropdown-item {
                padding: 1rem;
                font-size: 0.9rem;
            }

            .form-group .btn {
                margin-bottom: 0.5rem;
                width: 100%;
            }

            .image-upload {
                padding: 1rem;
            }

            input, select, textarea {
                font-size: 16px;
            }

            .view-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }

            .view-buttons {
                justify-content: center;
            }

            .artwork-list-info {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .artwork-list-item {
                grid-template-columns: 60px 1fr;
                gap: 0.8rem;
            }

            .artwork-list-image {
                width: 60px;
                height: 60px;
            }

            .notification {
                top: 10px;
                right: 10px;
                left: 10px;
                transform: translateY(-100%);
            }

            .notification.show {
                transform: translateY(0);
            }

            .auth-container {
                margin: 20px auto;
                padding: 1rem;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 5px;
            }

            .header {
                padding: 1rem 0.5rem;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .header p {
                font-size: 0.9rem;
            }

            .tab-content {
                padding: 0.8rem;
            }

            .stats {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .stat-card {
                padding: 0.8rem;
            }

            .stat-value {
                font-size: 1.3rem;
            }

            .artwork-info {
                padding: 1rem;
            }

            .artwork-title {
                font-size: 1.1rem;
            }

            .form-row {
                gap: 0.5rem;
            }

            .modal-content {
                margin: 5px auto;
                padding: 0.8rem;
                width: 98%;
            }

            .dropdown-item {
                padding: 0.8rem;
            }

            .btn {
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
            }
        }

        /* è§¸æ§å„ªåŒ– */
        @media (hover: none) and (pointer: coarse) {
            .btn {
                min-height: 44px;
            }

            .nav-tab {
                min-height: 48px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .dropdown-item {
                min-height: 44px;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }

            .artwork-actions .btn {
                min-height: 40px;
            }
        }
    </style>
</head>
<body>
    <!-- è¼‰å…¥æŒ‡ç¤ºå™¨ -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
    </div>

    <!-- åŒæ­¥æŒ‡ç¤ºå™¨ -->
    <div class="sync-indicator" id="syncIndicator">å·²åŒæ­¥ / Synced</div>

    <!-- ç™»å…¥é é¢ -->
    <div id="authContainer" class="auth-container">
        <div class="auth-header">
            <h2>è—è¡“ä½œå“ç®¡ç†ç³»çµ±</h2>
            <p>Artwork Management System</p>
        </div>
        
        <div class="auth-tabs">
            <button class="auth-tab active" onclick="switchAuthTab('login')">ç™»å…¥ / Login</button>
            <button class="auth-tab" onclick="switchAuthTab('register')">è¨»å†Š / Register</button>
        </div>

        <form id="loginForm" class="auth-form active">
            <div class="form-group">
                <label for="loginEmail">é›»å­éƒµä»¶ / Email</label>
                <input type="email" id="loginEmail" required placeholder="è«‹è¼¸å…¥æ‚¨çš„é›»å­éƒµä»¶">
            </div>
            <div class="form-group">
                <label for="loginPassword">å¯†ç¢¼ / Password</label>
                <input type="password" id="loginPassword" required placeholder="è«‹è¼¸å…¥æ‚¨çš„å¯†ç¢¼">
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-primary" style="width: 100%;">ç™»å…¥ / Login</button>
            </div>
        </form>

        <form id="registerForm" class="auth-form">
            <div class="form-group">
                <label for="registerName">å§“å / Name</label>
                <input type="text" id="registerName" required placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
            </div>
            <div class="form-group">
                <label for="registerEmail">é›»å­éƒµä»¶ / Email</label>
                <input type="email" id="registerEmail" required placeholder="è«‹è¼¸å…¥æ‚¨çš„é›»å­éƒµä»¶">
            </div>
            <div class="form-group">
                <label for="registerPassword">å¯†ç¢¼ / Password</label>
                <input type="password" id="registerPassword" required minlength="6" placeholder="å¯†ç¢¼è‡³å°‘6å€‹å­—ç¬¦">
            </div>
            <div class="form-group">
                <label for="registerConfirmPassword">ç¢ºèªå¯†ç¢¼ / Confirm Password</label>
                <input type="password" id="registerConfirmPassword" required minlength="6" placeholder="è«‹å†æ¬¡è¼¸å…¥å¯†ç¢¼">
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-primary" style="width: 100%;">è¨»å†Š / Register</button>
            </div>
        </form>
    </div>

    <!-- ä¸»æ‡‰ç”¨ -->
    <div id="mainApp" class="container" style="display: none;">
        <div class="header">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar"></div>
                <span id="userName"></span>
                <button class="logout-btn" onclick="logout()">ç™»å‡º / Logout</button>
            </div>
            <h1>è—è¡“ä½œå“ç®¡ç†ç³»çµ± / Artwork Management System</h1>
            <p>å°ˆæ¥­çš„è—è¡“ä½œå“åº«å­˜ç®¡ç†ç³»çµ± / Professional Artwork Inventory Management</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">å„€è¡¨æ¿ / Dashboard</button>
            <button class="nav-tab" onclick="showTab('add-artwork')">æ–°å¢ä½œå“ / Add Artwork</button>
            <button class="nav-tab" onclick="showTab('gallery')">ä½œå“åº« / Gallery</button>
        </div>

        <div id="dashboard" class="tab-content active">
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalArtworks">0</div>
                    <div class="stat-label">ç¸½ä½œå“æ•¸ / Total Artworks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="availableArtworks">0</div>
                    <div class="stat-label">å¯å”®ä½œå“ / Available</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="soldArtworks">0</div>
                    <div class="stat-label">å·²å”®ä½œå“ / Sold</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalValue">$0</div>
                    <div class="stat-label">ç¸½åƒ¹å€¼ / Total Value</div>
                </div>
            </div>

            <div class="form-group">
                <div class="btn-group">
                    <button class="btn btn-success btn-dropdown" onclick="toggleExportDropdown()">
                        ğŸ“¤ åŒ¯å‡ºè³‡æ–™ / Export Data
                    </button>
                    <div class="dropdown-menu" id="exportDropdown">
                        <button class="dropdown-item" onclick="exportToExcel()">
                            ğŸ“Š Excel (.xlsx) æ ¼å¼<br>
                            <small style="color: #666;">åŒ…å«åœ–ç‰‡çš„å®Œæ•´Excelå·¥ä½œè¡¨ / Complete Excel workbook with images</small>
                        </button>
                        <button class="dropdown-item" onclick="exportToPDF()">
                            ğŸ“‹ PDF æ ¼å¼<br>
                            <small style="color: #666;">é©åˆåˆ—å°èˆ‡å±•ç¤º / For printing & display</small>
                        </button>
                    </div>
                </div>
                <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰è³‡æ–™ / Clear All Data</button>
            </div>
        </div>

        <div id="add-artwork" class="tab-content">
            <h2>æ–°å¢è—è¡“ä½œå“ / Add New Artwork</h2>
            <form id="artworkForm">
                <div class="form-group">
                    <label for="artworkImage">ä½œå“åœ–ç‰‡ / Artwork Image</label>
                    <div class="image-upload" id="imageUpload">
                        <p>é»æ“Šé¸æ“‡æˆ–æ‹–æ‹½åœ–ç‰‡åˆ°æ­¤è™• / Click to select or drag image here</p>
                        <input type="file" id="artworkImage" accept="image/*" style="display: none;">
                    </div>
                    <div class="image-preview" id="imagePreview"></div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="artworkNumber">ç·¨è™Ÿ / Number *</label>
                        <input type="text" id="artworkNumber" required placeholder="ä¾‹ï¼šAW001">
                    </div>
                    <div class="form-group">
                        <label for="artworkTitle">ä½œå“åç¨± / Title *</label>
                        <input type="text" id="artworkTitle" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="artistName">è—è¡“å®¶ / Artist *</label>
                        <input type="text" id="artistName" required>
                    </div>
                    <div class="form-group">
                        <label for="yearCreated">å¹´ä»½ / Year</label>
                        <input type="number" id="yearCreated" min="1000" max="2025">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="dimensions">å°ºå¯¸ / Dimensions</label>
                        <input type="text" id="dimensions" placeholder="ä¾‹ï¼š50x70cm">
                    </div>
                    <div class="form-group">
                        <label for="medium">åª’æ / Medium</label>
                        <input type="text" id="medium" placeholder="ä¾‹ï¼šæ²¹å½©ã€å£“å…‹åŠ›ã€æ°´å½©ç­‰...">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="price">æ¨™åƒ¹ / Price (NT$)</label>
                        <input type="number" id="price" min="0" step="1">
                    </div>
                    <div class="form-group">
                        <label for="status">ç‹€æ…‹ / Status</label>
                        <select id="status">
                            <option value="available">å¯å”® / Available</option>
                            <option value="sold">å·²å”® / Sold</option>
                            <option value="on-hold">ä¿ç•™ä¸­ / On Hold</option>
                            <option value="exhibition">å±•è¦½ä¸­ / In Exhibition</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="concept">å‰µä½œç†å¿µ / Creative Concept</label>
                    <textarea id="concept" rows="4" placeholder="è«‹æè¿°ä½œå“çš„å‰µä½œç†å¿µèˆ‡éˆæ„Ÿä¾†æº..."></textarea>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">æ–°å¢ä½œå“ / Add Artwork</button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">é‡è¨­è¡¨å–® / Reset Form</button>
                </div>
            </form>
        </div>

        <div id="gallery" class="tab-content">
            <div class="view-controls">
                <h2>ä½œå“åº« / Artwork Gallery</h2>
                <div class="view-buttons">
                    <button class="view-btn active" onclick="switchView('grid')" title="ç£šå½¢é¡¯ç¤º / Grid View">
                        ğŸ“±
                    </button>
                    <button class="view-btn" onclick="switchView('list')" title="åˆ—è¡¨é¡¯ç¤º / List View">
                        ğŸ“‹
                    </button>
                    <button class="print-btn" onclick="printArtworks()">
                        ğŸ–¨ï¸ åˆ—å° / Print
                    </button>
                </div>
            </div>
            
            <div class="search-filters">
                <div class="form-group">
                    <input type="text" id="searchInput" placeholder="æœå°‹ä½œå“åç¨±ã€è—è¡“å®¶æˆ–ç·¨è™Ÿ... / Search by title, artist or number...">
                </div>
                <div class="form-group">
                    <select id="statusFilter">
                        <option value="">æ‰€æœ‰ç‹€æ…‹ / All Status</option>
                        <option value="available">å¯å”® / Available</option>
                        <option value="sold">å·²å”® / Sold</option>
                        <option value="on-hold">ä¿ç•™ä¸­ / On Hold</option>
                        <option value="exhibition">å±•è¦½ä¸­ / In Exhibition</option>
                    </select>
                </div>
                <div class="form-group">
                    <select id="sortBy">
                        <option value="number">ä¾ç·¨è™Ÿæ’åº / Sort by Number</option>
                        <option value="title">ä¾ä½œå“åç¨±æ’åº / Sort by Title</option>
                        <option value="artist">ä¾è—è¡“å®¶æ’åº / Sort by Artist</option>
                        <option value="year">ä¾å¹´ä»½æ’åº / Sort by Year</option>
                        <option value="price">ä¾åƒ¹æ ¼æ’åº / Sort by Price</option>
                    </select>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="applyFilters()">å¥—ç”¨ç¯©é¸ / Apply Filters</button>
                </div>
            </div>

            <div class="artwork-grid" id="artworkGrid">
                <!-- ä½œå“å¡ç‰‡å°‡åœ¨é€™è£¡é¡¯ç¤º / Artwork cards will be displayed here -->
            </div>

            <div class="artwork-list" id="artworkList">
                <!-- ä½œå“åˆ—è¡¨å°‡åœ¨é€™è£¡é¡¯ç¤º / Artwork list will be displayed here -->
            </div>
        </div>
    </div>

    <!-- ç·¨è¼¯æ¨¡æ…‹è¦–çª— / Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ç·¨è¼¯ä½œå“ / Edit Artwork</h3>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            <form id="editForm">
                <input type="hidden" id="editId">
                
                <div class="form-group">
                    <label for="editImage">ä½œå“åœ–ç‰‡ / Artwork Image</label>
                    <div class="image-upload" id="editImageUpload">
                        <p>é»æ“Šé¸æ“‡æˆ–æ‹–æ‹½åœ–ç‰‡åˆ°æ­¤è™• / Click to select or drag image here</p>
                        <input type="file" id="editImage" accept="image/*" style="display: none;">
                    </div>
                    <div class="image-preview" id="editImagePreview"></div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editNumber">ç·¨è™Ÿ / Number *</label>
                        <input type="text" id="editNumber" required>
                    </div>
                    <div class="form-group">
                        <label for="editTitle">ä½œå“åç¨± / Title *</label>
                        <input type="text" id="editTitle" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editArtist">è—è¡“å®¶ / Artist *</label>
                        <input type="text" id="editArtist" required>
                    </div>
                    <div class="form-group">
                        <label for="editYear">å¹´ä»½ / Year</label>
                        <input type="number" id="editYear" min="1000" max="2025">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editDimensions">å°ºå¯¸ / Dimensions</label>
                        <input type="text" id="editDimensions">
                    </div>
                    <div class="form-group">
                        <label for="editMedium">åª’æ / Medium</label>
                        <input type="text" id="editMedium" placeholder="ä¾‹ï¼šæ²¹å½©ã€å£“å…‹åŠ›ã€æ°´å½©ç­‰...">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editPrice">æ¨™åƒ¹ / Price (NT$)</label>
                        <input type="number" id="editPrice" min="0" step="1">
                    </div>
                    <div class="form-group">
                        <label for="editStatus">ç‹€æ…‹ / Status</label>
                        <select id="editStatus">
                            <option value="available">å¯å”® / Available</option>
                            <option value="sold">å·²å”® / Sold</option>
                            <option value="on-hold">ä¿ç•™ä¸­ / On Hold</option>
                            <option value="exhibition">å±•è¦½ä¸­ / In Exhibition</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="editConcept">å‰µä½œç†å¿µ / Creative Concept</label>
                    <textarea id="editConcept" rows="4" placeholder="è«‹æè¿°ä½œå“çš„å‰µä½œç†å¿µèˆ‡éˆæ„Ÿä¾†æº..."></textarea>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">æ›´æ–°ä½œå“ / Update Artwork</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">å–æ¶ˆ / Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- SheetJS for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        // æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹
        let artworks = [];
        let currentUser = null;
        let currentEditId = null;
        let autoSaveInterval = null;
        let currentView = 'grid'; // 'grid' æˆ– 'list'

        // ç‹€æ…‹ç¿»è­¯
        const statusTranslations = {
            'available': 'å¯å”®',
            'sold': 'å·²å”®',
            'on-hold': 'ä¿ç•™ä¸­',
            'exhibition': 'å±•è¦½ä¸­'
        };

        // ç”¨æˆ¶å¸³æˆ¶ç³»çµ± (ä½¿ç”¨ localStorage æ¨¡æ“¬)
        class UserManager {
            static generateUserId() {
                return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }

            static hashPassword(password) {
                // ç°¡å–®çš„å¯†ç¢¼å“ˆå¸Œ (å¯¦éš›æ‡‰ç”¨ä¸­æ‡‰ä½¿ç”¨æ›´å®‰å…¨çš„æ–¹æ³•)
                let hash = 0;
                for (let i = 0; i < password.length; i++) {
                    const char = password.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return hash.toString();
            }

            static register(name, email, password, confirmPassword) {
                if (password !== confirmPassword) {
                    throw new Error('å¯†ç¢¼ç¢ºèªä¸ç¬¦ / Password confirmation does not match');
                }

                const users = JSON.parse(localStorage.getItem('users') || '{}');
                
                if (users[email]) {
                    throw new Error('æ­¤é›»å­éƒµä»¶å·²è¨»å†Š / This email is already registered');
                }

                const userId = this.generateUserId();
                const hashedPassword = this.hashPassword(password);

                users[email] = {
                    id: userId,
                    name: name,
                    email: email,
                    password: hashedPassword,
                    createdAt: new Date().toISOString()
                };

                localStorage.setItem('users', JSON.stringify(users));
                return users[email];
            }

            static login(email, password) {
                const users = JSON.parse(localStorage.getItem('users') || '{}');
                const user = users[email];

                if (!user) {
                    throw new Error('ç”¨æˆ¶ä¸å­˜åœ¨ / User does not exist');
                }

                const hashedPassword = this.hashPassword(password);
                if (user.password !== hashedPassword) {
                    throw new Error('å¯†ç¢¼éŒ¯èª¤ / Incorrect password');
                }

                // è¨­ç½®ç•¶å‰ç”¨æˆ¶
                localStorage.setItem('currentUser', JSON.stringify(user));
                return user;
            }

            static getCurrentUser() {
                const userStr = localStorage.getItem('currentUser');
                return userStr ? JSON.parse(userStr) : null;
            }

            static logout() {
                localStorage.removeItem('currentUser');
            }
        }

        // é›²ç«¯å­˜å„²æ¨¡æ“¬ (ä½¿ç”¨ localStorage)
        class CloudStorage {
            static saveUserData(userId, artworks) {
                const key = `artworks_${userId}`;
                localStorage.setItem(key, JSON.stringify(artworks));
                this.showSyncStatus('å·²åŒæ­¥ / Synced', 'success');
            }

            static loadUserData(userId) {
                const key = `artworks_${userId}`;
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : [];
            }

            static showSyncStatus(message, type = 'success') {
                const indicator = document.getElementById('syncIndicator');
                indicator.textContent = message;
                indicator.className = `sync-indicator show ${type}`;
                
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 2000);
            }

            static autoSave(userId, artworks) {
                this.showSyncStatus('åŒæ­¥ä¸­... / Syncing...', 'syncing');
                
                setTimeout(() => {
                    this.saveUserData(userId, artworks);
                }, 500);
            }
        }

        // è¼‰å…¥å’Œé¡¯ç¤ºåŠŸèƒ½
        function showLoading() {
            document.getElementById('loading').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loading').classList.remove('show');
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // èªè­‰åŠŸèƒ½
        function switchAuthTab(tabName) {
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Form').classList.add('active');
        }

        async function login(email, password) {
            try {
                showLoading();
                
                const user = UserManager.login(email, password);
                currentUser = user;
                
                // è¼‰å…¥ç”¨æˆ¶è³‡æ–™
                artworks = CloudStorage.loadUserData(user.id);
                
                // åˆ‡æ›åˆ°ä¸»æ‡‰ç”¨
                document.getElementById('authContainer').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                
                // æ›´æ–°ç”¨æˆ¶ç•Œé¢
                document.getElementById('userName').textContent = user.name;
                document.getElementById('userAvatar').textContent = user.name.charAt(0).toUpperCase();
                
                // å•Ÿå‹•è‡ªå‹•å­˜æª”
                startAutoSave();
                
                // æ›´æ–°å„€è¡¨æ¿
                updateDashboard();
                
                showNotification('ç™»å…¥æˆåŠŸï¼ / Login successful!', 'success');
                
            } catch (error) {
                showNotification(error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        async function register(name, email, password, confirmPassword) {
            try {
                showLoading();
                
                const user = UserManager.register(name, email, password, confirmPassword);
                
                showNotification('è¨»å†ŠæˆåŠŸï¼è«‹ç™»å…¥ / Registration successful! Please login', 'success');
                
                // åˆ‡æ›åˆ°ç™»å…¥é é¢
                switchAuthTab('login');
                
            } catch (error) {
                showNotification(error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        function logout() {
            if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ / Are you sure you want to logout?')) {
                UserManager.logout();
                currentUser = null;
                artworks = [];
                
                // åœæ­¢è‡ªå‹•å­˜æª”
                if (autoSaveInterval) {
                    clearInterval(autoSaveInterval);
                    autoSaveInterval = null;
                }
                
                // åˆ‡æ›åˆ°ç™»å…¥é é¢
                document.getElementById('authContainer').style.display = 'block';
                document.getElementById('mainApp').style.display = 'none';
                
                // é‡ç½®è¡¨å–®
                document.getElementById('loginForm').reset();
                document.getElementById('registerForm').reset();
                
                showNotification('å·²ç™»å‡º / Logged out', 'info');
            }
        }

        // è‡ªå‹•å­˜æª”åŠŸèƒ½
        function startAutoSave() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
            
            autoSaveInterval = setInterval(() => {
                if (currentUser && artworks.length > 0) {
                    CloudStorage.autoSave(currentUser.id, artworks);
                }
            }, 30000); // æ¯30ç§’è‡ªå‹•å­˜æª”
        }

        function saveData() {
            if (currentUser) {
                CloudStorage.saveUserData(currentUser.id, artworks);
            }
        }

        // åˆ‡æ›åˆ†é 
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'gallery') {
                loadGallery();
            } else if (tabName === 'dashboard') {
                updateDashboard();
            }
        }

        // åœ–ç‰‡ä¸Šå‚³è™•ç†
        function setupImageUpload(uploadElement, previewElement, inputElement) {
            if (!uploadElement || !previewElement || !inputElement) return;
            
            uploadElement.addEventListener('click', () => {
                inputElement.click();
            });
            
            uploadElement.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadElement.classList.add('drag-over');
            });
            
            uploadElement.addEventListener('dragleave', () => {
                uploadElement.classList.remove('drag-over');
            });
            
            uploadElement.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadElement.classList.remove('drag-over');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleImageUpload(files[0], previewElement);
                }
            });
            
            inputElement.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleImageUpload(e.target.files[0], previewElement);
                }
            });
        }

        function handleImageUpload(file, previewElement) {
            if (!file.type.startsWith('image/')) {
                showNotification('è«‹é¸æ“‡æœ‰æ•ˆçš„åœ–ç‰‡æª”æ¡ˆ / Please select a valid image file', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                previewElement.innerHTML = `<img src="${e.target.result}" alt="é è¦½ / Preview">`;
                previewElement.dataset.imageData = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // è¡¨å–®è™•ç†
        async function handleArtworkSubmit(e) {
            e.preventDefault();
            
            try {
                const number = document.getElementById('artworkNumber').value.trim();
                const title = document.getElementById('artworkTitle').value.trim();
                const artist = document.getElementById('artistName').value.trim();
                
                if (!number || !title || !artist) {
                    showNotification('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ / Please fill in all required fields', 'error');
                    return;
                }
                
                if (artworks.some(artwork => artwork.number === number)) {
                    showNotification('æ­¤ç·¨è™Ÿå·²å­˜åœ¨ / This number already exists', 'error');
                    return;
                }
                
                const artwork = {
                    id: Date.now(),
                    number: number,
                    title: title,
                    artist: artist,
                    year: document.getElementById('yearCreated').value || null,
                    dimensions: document.getElementById('dimensions').value.trim(),
                    medium: document.getElementById('medium').value.trim(),
                    price: parseFloat(document.getElementById('price').value) || 0,
                    status: document.getElementById('status').value,
                    concept: document.getElementById('concept').value.trim(),
                    dateAdded: new Date().toISOString(),
                    image: document.getElementById('imagePreview').dataset.imageData || null
                };
                
                artworks.push(artwork);
                saveData();
                
                showNotification('ä½œå“æ–°å¢æˆåŠŸï¼ / Artwork added successfully!');
                resetForm();
                updateDashboard();
                
            } catch (error) {
                console.error('æ–°å¢ä½œå“éŒ¯èª¤:', error);
                showNotification('æ–°å¢ä½œå“å¤±æ•—ï¼š' + error.message, 'error');
            }
        }

        async function handleEditSubmit(e) {
            e.preventDefault();
            
            try {
                const id = parseInt(document.getElementById('editId').value);
                const number = document.getElementById('editNumber').value.trim();
                
                if (artworks.some(artwork => artwork.number === number && artwork.id !== id)) {
                    showNotification('æ­¤ç·¨è™Ÿå·²è¢«ä½¿ç”¨ / This number is already used', 'error');
                    return;
                }
                
                const artworkIndex = artworks.findIndex(a => a.id === id);
                if (artworkIndex === -1) return;
                
                const imageData = document.getElementById('editImagePreview').dataset.imageData;
                
                artworks[artworkIndex] = {
                    ...artworks[artworkIndex],
                    number: number,
                    title: document.getElementById('editTitle').value.trim(),
                    artist: document.getElementById('editArtist').value.trim(),
                    year: document.getElementById('editYear').value || null,
                    dimensions: document.getElementById('editDimensions').value.trim(),
                    medium: document.getElementById('editMedium').value.trim(),
                    price: parseFloat(document.getElementById('editPrice').value) || 0,
                    status: document.getElementById('editStatus').value,
                    concept: document.getElementById('editConcept').value.trim(),
                    image: imageData || artworks[artworkIndex].image
                };
                
                saveData();
                
                showNotification('ä½œå“æ›´æ–°æˆåŠŸï¼ / Artwork updated successfully!');
                closeEditModal();
                loadGallery();
                updateDashboard();
                
            } catch (error) {
                console.error('æ›´æ–°ä½œå“éŒ¯èª¤:', error);
                showNotification('æ›´æ–°ä½œå“å¤±æ•—ï¼š' + error.message, 'error');
            }
        }

        function resetForm() {
            document.getElementById('artworkForm').reset();
            document.getElementById('imagePreview').innerHTML = '';
            delete document.getElementById('imagePreview').dataset.imageData;
        }

        // å„€è¡¨æ¿æ›´æ–°
        function updateDashboard() {
            try {
                const stats = {
                    total: artworks.length,
                    available: artworks.filter(a => a.status === 'available').length,
                    sold: artworks.filter(a => a.status === 'sold').length,
                    totalValue: artworks.reduce((sum, a) => sum + (a.price || 0), 0)
                };
                
                document.getElementById('totalArtworks').textContent = stats.total;
                document.getElementById('availableArtworks').textContent = stats.available;
                document.getElementById('soldArtworks').textContent = stats.sold;
                document.getElementById('totalValue').textContent = `NT$${stats.totalValue.toLocaleString()}`;
                
            } catch (error) {
                console.error('æ›´æ–°å„€è¡¨æ¿éŒ¯èª¤:', error);
            }
        }

        // è¦–åœ–åˆ‡æ›åŠŸèƒ½
        function switchView(viewType) {
            currentView = viewType;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // åˆ‡æ›è¦–åœ–
            const grid = document.getElementById('artworkGrid');
            const list = document.getElementById('artworkList');
            
            if (viewType === 'grid') {
                grid.style.display = 'grid';
                list.classList.remove('active');
            } else {
                grid.style.display = 'none';
                list.classList.add('active');
            }
            
            // é‡æ–°è¼‰å…¥ç•¶å‰é¡¯ç¤ºçš„ä½œå“
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const sortBy = document.getElementById('sortBy').value;
            
            let filteredArtworks = artworks.filter(artwork => {
                const matchesSearch = !searchTerm || 
                    artwork.title.toLowerCase().includes(searchTerm) ||
                    artwork.artist.toLowerCase().includes(searchTerm) ||
                    artwork.number.toLowerCase().includes(searchTerm);
                    
                const matchesStatus = !statusFilter || artwork.status === statusFilter;
                
                return matchesSearch && matchesStatus;
            });
            
            // æ’åº
            filteredArtworks.sort((a, b) => {
                switch (sortBy) {
                    case 'number':
                        return a.number.localeCompare(b.number);
                    case 'title':
                        return a.title.localeCompare(b.title);
                    case 'artist':
                        return a.artist.localeCompare(b.artist);
                    case 'year':
                        return (b.year || 0) - (a.year || 0);
                    case 'price':
                        return (b.price || 0) - (a.price || 0);
                    default:
                        return 0;
                }
            });
            
            displayArtworks(filteredArtworks);
        }

        // åˆ—å°åŠŸèƒ½
        function printArtworks() {
            // ç²å–ç•¶å‰é¡¯ç¤ºçš„ä½œå“
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            
            let filteredArtworks = artworks.filter(artwork => {
                const matchesSearch = !searchTerm || 
                    artwork.title.toLowerCase().includes(searchTerm) ||
                    artwork.artist.toLowerCase().includes(searchTerm) ||
                    artwork.number.toLowerCase().includes(searchTerm);
                    
                const matchesStatus = !statusFilter || artwork.status === statusFilter;
                
                return matchesSearch && matchesStatus;
            });

            if (filteredArtworks.length === 0) {
                showNotification('æ²’æœ‰ä½œå“å¯ä»¥åˆ—å° / No artworks to print', 'info');
                return;
            }

            // å‰µå»ºåˆ—å°å…§å®¹
            let printContent = `
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>è—è¡“ä½œå“æ¸…å–® / Artwork List</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #333; text-align: center; margin-bottom: 10px; }
                        .header-info { text-align: center; margin-bottom: 20px; color: #666; font-size: 14px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 12px; }
                        th { background-color: #f2f2f2; font-weight: bold; }
                        .status-available { color: #28a745; }
                        .status-sold { color: #dc3545; }
                        .status-on-hold { color: #ffc107; }
                        .status-exhibition { color: #17a2b8; }
                        .artwork-image { width: 60px; height: 60px; object-fit: cover; }
                        @page { size: A4; margin: 1cm; }
                    </style>
                </head>
                <body>
                    <h1>è—è¡“ä½œå“æ¸…å–® / Artwork Inventory</h1>
                    <div class="header-info">
                        <p>ç”¨æˆ¶ / User: ${currentUser.name} | åˆ—å°æ—¥æœŸ / Print Date: ${new Date().toLocaleDateString('zh-TW')} ${new Date().toLocaleTimeString('zh-TW')}</p>
                        <p>å…± ${filteredArtworks.length} ä»¶ä½œå“ / Total ${filteredArtworks.length} artworks</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>åœ–ç‰‡</th>
                                <th>ç·¨è™Ÿ</th>
                                <th>ä½œå“åç¨±</th>
                                <th>è—è¡“å®¶</th>
                                <th>å¹´ä»½</th>
                                <th>å°ºå¯¸</th>
                                <th>åª’æ</th>
                                <th>æ¨™åƒ¹</th>
                                <th>ç‹€æ…‹</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            filteredArtworks.forEach(artwork => {
                printContent += `
                    <tr>
                        <td>${artwork.image ? `<img src="${artwork.image}" class="artwork-image">` : '-'}</td>
                        <td>${artwork.number || ''}</td>
                        <td>${artwork.title || ''}</td>
                        <td>${artwork.artist || ''}</td>
                        <td>${artwork.year || ''}</td>
                        <td>${artwork.dimensions || ''}</td>
                        <td>${mediumTranslations[artwork.medium] || artwork.medium || ''}</td>
                        <td>NT${artwork.price ? artwork.price.toLocaleString() : '0'}</td>
                        <td class="status-${artwork.status}">${statusTranslations[artwork.status] || artwork.status}</td>
                    </tr>
                `;
            });

            printContent += `
                        </tbody>
                    </table>
                </body>
                </html>
            `;

            // é–‹å•Ÿæ–°è¦–çª—ä¸¦åˆ—å°
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            
            setTimeout(() => {
                printWindow.print();
                showNotification('åˆ—å°è¦–çª—å·²é–‹å•Ÿ / Print window opened');
            }, 500);
        }

        // ä½œå“åº«è¼‰å…¥
        function loadGallery() {
            displayArtworks(artworks);
        }

        function displayArtworks(artworksToShow) {
            const grid = document.getElementById('artworkGrid');
            const list = document.getElementById('artworkList');
            
            if (!grid || !list) return;
            
            // æ¸…ç©ºå…§å®¹
            grid.innerHTML = '';
            list.innerHTML = '';
            
            if (artworksToShow.length === 0) {
                const emptyMessage = '<p>æ²’æœ‰æ‰¾åˆ°ä½œå“ã€‚è«‹å…ˆæ–°å¢ä¸€äº›ä½œå“ï¼ / No artworks found. Please add some artworks first!</p>';
                grid.innerHTML = emptyMessage;
                list.innerHTML = emptyMessage;
                return;
            }
            
            // ç£šå½¢è¦–åœ–
            artworksToShow.forEach(artwork => {
                const card = document.createElement('div');
                card.className = 'artwork-card';
                
                card.innerHTML = `
                    ${artwork.image ? `<img src="${artwork.image}" alt="${artwork.title}" class="artwork-image">` : '<div class="artwork-image" style="background: #f0f0f0; display: flex; align-items: center; justify-content: center; color: #666;">ç„¡åœ–ç‰‡ / No Image</div>'}
                    <div class="artwork-info">
                        <div class="artwork-title">${artwork.title}</div>
                        <div class="artwork-artist">${artwork.artist}</div>
                        <div class="artwork-details">
                            ç·¨è™Ÿ / Numberï¼š${artwork.number} ${artwork.year ? `â€¢ ${artwork.year}å¹´` : ''}
                            ${artwork.dimensions ? `â€¢ ${artwork.dimensions}` : ''}
                            ${artwork.medium ? `â€¢ ${artwork.medium}` : ''}
                        </div>
                        ${artwork.concept ? `<div class="artwork-details" style="font-style: italic; color: #555; margin-top: 0.5rem;">ç†å¿µ / Concept: ${artwork.concept.substring(0, 80)}${artwork.concept.length > 80 ? '...' : ''}</div>` : ''}
                        <div class="artwork-details">
                            ${artwork.price > 0 ? `NT${artwork.price.toLocaleString()}` : 'æœªå®šåƒ¹ / Price not set'}
                            <span class="status-badge status-${artwork.status}">${statusTranslations[artwork.status]}</span>
                        </div>
                        <div class="artwork-actions">
                            <button class="btn btn-primary" onclick="editArtwork(${artwork.id})">ç·¨è¼¯ / Edit</button>
                            <button class="btn btn-danger" onclick="deleteArtworkConfirm(${artwork.id})">åˆªé™¤ / Delete</button>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
            
            // åˆ—è¡¨è¦–åœ–
            artworksToShow.forEach(artwork => {
                const listItem = document.createElement('div');
                listItem.className = 'artwork-list-item';
                
                listItem.innerHTML = `
                    ${artwork.image ? `<img src="${artwork.image}" alt="${artwork.title}" class="artwork-list-image">` : '<div class="artwork-list-image" style="background: #f0f0f0; display: flex; align-items: center; justify-content: center; color: #666; font-size: 0.8rem;">ç„¡åœ–</div>'}
                    <div class="artwork-list-info">
                        <div class="artwork-list-detail">
                            <div class="artwork-list-title">${artwork.title}</div>
                            <div class="artwork-list-subtitle">ç·¨è™Ÿï¼š${artwork.number}</div>
                        </div>
                        <div class="artwork-list-detail">
                            <div class="artwork-list-title">${artwork.artist}</div>
                            <div class="artwork-list-subtitle">${artwork.year ? `${artwork.year}å¹´` : 'å¹´ä»½æœªçŸ¥'}</div>
                        </div>
                        <div class="artwork-list-detail">
                            <div class="artwork-list-title">${artwork.dimensions || 'æœªæŒ‡å®šå°ºå¯¸'}</div>
                            <div class="artwork-list-subtitle">${artwork.medium || 'æœªæŒ‡å®šåª’æ'}</div>
                        </div>
                        <div class="artwork-list-detail">
                            <div class="artwork-list-title">${artwork.price > 0 ? `NT${artwork.price.toLocaleString()}` : 'æœªå®šåƒ¹'}</div>
                            <div class="artwork-list-subtitle">
                                <span class="status-badge status-${artwork.status}">${statusTranslations[artwork.status]}</span>
                            </div>
                        </div>
                    </div>
                    <div class="artwork-actions">
                        <button class="btn btn-primary" onclick="editArtwork(${artwork.id})" style="margin-bottom: 0.5rem;">ç·¨è¼¯</button>
                        <button class="btn btn-danger" onclick="deleteArtworkConfirm(${artwork.id})">åˆªé™¤</button>
                    </div>
                `;
                
                list.appendChild(listItem);
            });
        }

        // ç¯©é¸åŠŸèƒ½
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const sortBy = document.getElementById('sortBy').value;
            
            let filteredArtworks = artworks.filter(artwork => {
                const matchesSearch = !searchTerm || 
                    artwork.title.toLowerCase().includes(searchTerm) ||
                    artwork.artist.toLowerCase().includes(searchTerm) ||
                    artwork.number.toLowerCase().includes(searchTerm);
                    
                const matchesStatus = !statusFilter || artwork.status === statusFilter;
                
                return matchesSearch && matchesStatus;
            });
            
            // æ’åºä½œå“
            filteredArtworks.sort((a, b) => {
                switch (sortBy) {
                    case 'number':
                        return a.number.localeCompare(b.number);
                    case 'title':
                        return a.title.localeCompare(b.title);
                    case 'artist':
                        return a.artist.localeCompare(b.artist);
                    case 'year':
                        return (b.year || 0) - (a.year || 0);
                    case 'price':
                        return (b.price || 0) - (a.price || 0);
                    default:
                        return 0;
                }
            });
            
            displayArtworks(filteredArtworks);
        }

        // ç·¨è¼¯åŠŸèƒ½
        function editArtwork(id) {
            const artwork = artworks.find(a => a.id === id);
            if (!artwork) return;
            
            currentEditId = id;
            
            document.getElementById('editId').value = id;
            document.getElementById('editNumber').value = artwork.number || '';
            document.getElementById('editTitle').value = artwork.title || '';
            document.getElementById('editArtist').value = artwork.artist || '';
            document.getElementById('editYear').value = artwork.year || '';
            document.getElementById('editDimensions').value = artwork.dimensions || '';
            document.getElementById('editMedium').value = artwork.medium || '';
            document.getElementById('editPrice').value = artwork.price || '';
            document.getElementById('editStatus').value = artwork.status || 'available';
            document.getElementById('editConcept').value = artwork.concept || '';
            
            if (artwork.image) {
                document.getElementById('editImagePreview').innerHTML = `<img src="${artwork.image}" alt="é è¦½ / Preview">`;
                document.getElementById('editImagePreview').dataset.imageData = artwork.image;
            } else {
                document.getElementById('editImagePreview').innerHTML = '';
                delete document.getElementById('editImagePreview').dataset.imageData;
            }
            
            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            document.getElementById('editImagePreview').innerHTML = '';
            delete document.getElementById('editImagePreview').dataset.imageData;
            currentEditId = null;
        }

        function deleteArtworkConfirm(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ä»¶ä½œå“å—ï¼Ÿ / Are you sure you want to delete this artwork?')) {
                artworks = artworks.filter(a => a.id !== id);
                saveData();
                showNotification('ä½œå“å·²åˆªé™¤ / Artwork deleted');
                loadGallery();
                updateDashboard();
            }
        }

        // ä¸‹æ‹‰é¸å–®æ§åˆ¶
        function toggleExportDropdown() {
            const dropdown = document.getElementById('exportDropdown');
            dropdown.classList.toggle('show');
        }

        // ExcelåŒ¯å‡ºåŠŸèƒ½ (.xlsxæ ¼å¼ï¼ŒåŒ…å«åœ–ç‰‡)
        function exportToExcel() {
            document.getElementById('exportDropdown').classList.remove('show');
            
            if (artworks.length === 0) {
                showNotification('æ²’æœ‰ä½œå“å¯ä»¥åŒ¯å‡º / No artworks to export', 'info');
                return;
            }

            try {
                showLoading();
                
                // å‰µå»ºæ–°çš„å·¥ä½œç°¿
                const wb = XLSX.utils.book_new();
                
                // æº–å‚™åŸºæœ¬è³‡æ–™
                const data = artworks.map(artwork => ({
                    'ç·¨è™Ÿ': artwork.number || '',
                    'ä½œå“åç¨±': artwork.title || '',
                    'è—è¡“å®¶': artwork.artist || '',
                    'å¹´ä»½': artwork.year || '',
                    'å°ºå¯¸': artwork.dimensions || '',
                    'åª’æ': artwork.medium || '',
                    'æ¨™åƒ¹': artwork.price || 0,
                    'ç‹€æ…‹': statusTranslations[artwork.status] || artwork.status,
                    'å‰µä½œç†å¿µ': artwork.concept || '',
                    'æ–°å¢æ—¥æœŸ': artwork.dateAdded ? new Date(artwork.dateAdded).toLocaleDateString('zh-TW') : '',
                    'åœ–ç‰‡': artwork.image ? 'æœ‰åœ–ç‰‡' : 'ç„¡åœ–ç‰‡'
                }));
                
                // å‰µå»ºåŸºæœ¬è³‡æ–™å·¥ä½œè¡¨
                const ws = XLSX.utils.json_to_sheet(data);
                
                // è¨­å®šæ¬„å¯¬
                const colWidths = [
                    { wch: 12 }, // ç·¨è™Ÿ
                    { wch: 25 }, // ä½œå“åç¨±
                    { wch: 20 }, // è—è¡“å®¶
                    { wch: 8 },  // å¹´ä»½
                    { wch: 15 }, // å°ºå¯¸
                    { wch: 15 }, // åª’æ
                    { wch: 15 }, // æ¨™åƒ¹
                    { wch: 12 }, // ç‹€æ…‹
                    { wch: 40 }, // å‰µä½œç†å¿µ
                    { wch: 15 }, // æ–°å¢æ—¥æœŸ
                    { wch: 10 }  // åœ–ç‰‡
                ];
                ws['!cols'] = colWidths;
                
                // æ·»åŠ å·¥ä½œè¡¨åˆ°å·¥ä½œç°¿
                XLSX.utils.book_append_sheet(wb, ws, 'ä½œå“æ¸…å–®');
                
                // å‰µå»ºåœ–ç‰‡è³‡æ–™å·¥ä½œè¡¨
                const imageData = artworks
                    .filter(artwork => artwork.image)
                    .map(artwork => ({
                        'ç·¨è™Ÿ': artwork.number,
                        'ä½œå“åç¨±': artwork.title,
                        'åœ–ç‰‡è³‡æ–™': artwork.image
                    }));
                
                if (imageData.length > 0) {
                    const imageWs = XLSX.utils.json_to_sheet(imageData);
                    imageWs['!cols'] = [
                        { wch: 12 }, // ç·¨è™Ÿ
                        { wch: 25 }, // ä½œå“åç¨±
                        { wch: 50 }  // åœ–ç‰‡è³‡æ–™
                    ];
                    XLSX.utils.book_append_sheet(wb, imageWs, 'åœ–ç‰‡è³‡æ–™');
                }
                
                // å‰µå»ºçµ±è¨ˆè³‡æ–™å·¥ä½œè¡¨
                const statsData = [
                    { 'çµ±è¨ˆé …ç›®': 'ç¸½ä½œå“æ•¸', 'æ•¸é‡': artworks.length },
                    { 'çµ±è¨ˆé …ç›®': 'å¯å”®ä½œå“', 'æ•¸é‡': artworks.filter(a => a.status === 'available').length },
                    { 'çµ±è¨ˆé …ç›®': 'å·²å”®ä½œå“', 'æ•¸é‡': artworks.filter(a => a.status === 'sold').length },
                    { 'çµ±è¨ˆé …ç›®': 'ä¿ç•™ä¸­ä½œå“', 'æ•¸é‡': artworks.filter(a => a.status === 'on-hold').length },
                    { 'çµ±è¨ˆé …ç›®': 'å±•è¦½ä¸­ä½œå“', 'æ•¸é‡': artworks.filter(a => a.status === 'exhibition').length },
                    { 'çµ±è¨ˆé …ç›®': 'ç¸½åƒ¹å€¼', 'æ•¸é‡': `NT$${artworks.reduce((sum, a) => sum + (a.price || 0), 0).toLocaleString()}` },
                    { 'çµ±è¨ˆé …ç›®': 'æœ‰åœ–ç‰‡ä½œå“', 'æ•¸é‡': artworks.filter(a => a.image).length }
                ];
                
                const statsWs = XLSX.utils.json_to_sheet(statsData);
                statsWs['!cols'] = [{ wch: 20 }, { wch: 20 }];
                XLSX.utils.book_append_sheet(wb, statsWs, 'çµ±è¨ˆ');
                
                // åŒ¯å‡ºæª”æ¡ˆ
                const fileName = `artwork-inventory-${currentUser.name}-${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, fileName);
                
                showNotification('Excelæª”æ¡ˆåŒ¯å‡ºæˆåŠŸï¼ / Excel file exported successfully!');
                
            } catch (error) {
                console.error('åŒ¯å‡ºExceléŒ¯èª¤:', error);
                showNotification('åŒ¯å‡ºExcelå¤±æ•—ï¼š' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        // PDFåŒ¯å‡ºåŠŸèƒ½
        function exportToPDF() {
            document.getElementById('exportDropdown').classList.remove('show');
            
            if (artworks.length === 0) {
                showNotification('æ²’æœ‰ä½œå“å¯ä»¥åŒ¯å‡º / No artworks to export', 'info');
                return;
            }

            let htmlContent = `
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>è—è¡“ä½œå“æ¸…å–® / Artwork List</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #333; text-align: center; }
                        .header-info { text-align: center; margin-bottom: 20px; color: #666; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; font-weight: bold; }
                        .status-available { color: #28a745; }
                        .status-sold { color: #dc3545; }
                        .status-on-hold { color: #ffc107; }
                        .status-exhibition { color: #17a2b8; }
                        .stats { margin-top: 30px; }
                        .stats table { width: 50%; }
                    </style>
                </head>
                <body>
                    <h1>è—è¡“ä½œå“æ¸…å–® / Artwork Inventory</h1>
                    <div class="header-info">
                        <p>ç”¨æˆ¶ / User: ${currentUser.name}</p>
                        <p>ç”Ÿæˆæ—¥æœŸ / Generated: ${new Date().toLocaleDateString('zh-TW')} ${new Date().toLocaleTimeString('zh-TW')}</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ç·¨è™Ÿ</th>
                                <th>ä½œå“åç¨±</th>
                                <th>è—è¡“å®¶</th>
                                <th>å¹´ä»½</th>
                                <th>å°ºå¯¸</th>
                                <th>æ¨™åƒ¹</th>
                                <th>ç‹€æ…‹</th>
                                <th>åœ–ç‰‡</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            artworks.forEach(artwork => {
                htmlContent += `
                    <tr>
                        <td>${artwork.number || ''}</td>
                        <td>${artwork.title || ''}</td>
                        <td>${artwork.artist || ''}</td>
                        <td>${artwork.year || ''}</td>
                        <td>${artwork.dimensions || ''}</td>
                        <td>NT$${artwork.price ? artwork.price.toLocaleString() : '0'}</td>
                        <td class="status-${artwork.status}">${statusTranslations[artwork.status] || artwork.status}</td>
                        <td>${artwork.image ? 'âœ“' : 'âœ—'}</td>
                    </tr>
                `;
            });

            htmlContent += `
                        </tbody>
                    </table>
                    <div class="stats">
                        <h3>çµ±è¨ˆè³‡è¨Š / Statistics</h3>
                        <table>
                            <tr><td>ç¸½ä½œå“æ•¸ / Total</td><td>${artworks.length}</td></tr>
                            <tr><td>å¯å”®ä½œå“ / Available</td><td>${artworks.filter(a => a.status === 'available').length}</td></tr>
                            <tr><td>å·²å”®ä½œå“ / Sold</td><td>${artworks.filter(a => a.status === 'sold').length}</td></tr>
                            <tr><td>ç¸½åƒ¹å€¼ / Total Value</td><td>NT$${artworks.reduce((sum, a) => sum + (a.price || 0), 0).toLocaleString()}</td></tr>
                            <tr><td>æœ‰åœ–ç‰‡ä½œå“ / With Images</td><td>${artworks.filter(a => a.image).length}</td></tr>
                        </table>
                    </div>
                </body>
                </html>
            `;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(htmlContent);
            printWindow.document.close();
            
            setTimeout(() => {
                printWindow.print();
                showNotification('PDFç”Ÿæˆå®Œæˆ / PDF generated successfully');
            }, 500);
        }

        // æ¸…é™¤æ‰€æœ‰è³‡æ–™
        function clearAllData() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ä½œå“è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸ / Are you sure you want to clear all data? This action cannot be undone.')) {
                artworks = [];
                saveData();
                showNotification('æ‰€æœ‰è³‡æ–™å·²æ¸…é™¤ / All data cleared');
                updateDashboard();
                loadGallery();
            }
        }

        // åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼
        function initApp() {
            // æª¢æŸ¥æ˜¯å¦æœ‰å·²ç™»å…¥çš„ç”¨æˆ¶
            currentUser = UserManager.getCurrentUser();
            
            if (currentUser) {
                // å¦‚æœå·²ç™»å…¥ï¼Œé¡¯ç¤ºä¸»æ‡‰ç”¨
                artworks = CloudStorage.loadUserData(currentUser.id);
                document.getElementById('authContainer').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                
                // æ›´æ–°ç”¨æˆ¶ç•Œé¢
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
                
                // å•Ÿå‹•è‡ªå‹•å­˜æª”
                startAutoSave();
                
                // æ›´æ–°å„€è¡¨æ¿
                updateDashboard();
            } else {
                // å¦‚æœæœªç™»å…¥ï¼Œé¡¯ç¤ºç™»å…¥é é¢
                document.getElementById('authContainer').style.display = 'block';
                document.getElementById('mainApp').style.display = 'none';
            }
            
            // è¨­å®šåœ–ç‰‡ä¸Šå‚³
            setupImageUpload(
                document.getElementById('imageUpload'),
                document.getElementById('imagePreview'),
                document.getElementById('artworkImage')
            );
            
            setupImageUpload(
                document.getElementById('editImageUpload'),
                document.getElementById('editImagePreview'),
                document.getElementById('editImage')
            );
            
            // è¨­å®šè¡¨å–®äº‹ä»¶
            document.getElementById('artworkForm').addEventListener('submit', handleArtworkSubmit);
            document.getElementById('editForm').addEventListener('submit', handleEditSubmit);
            
            // è¨­å®šç™»å…¥å’Œè¨»å†Šè¡¨å–®
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                await login(email, password);
            });
            
            document.getElementById('registerForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const confirmPassword = document.getElementById('registerConfirmPassword').value;
                await register(name, email, password, confirmPassword);
            });
            
            // è¨­å®šæœå°‹åŠŸèƒ½
            document.getElementById('searchInput').addEventListener('input', applyFilters);
            
            showNotification('ç³»çµ±å·²è¼‰å…¥ / System loaded', 'success');
        }

        // äº‹ä»¶ç¶å®š
        document.addEventListener('DOMContentLoaded', initApp);

        // é»æ“Šå¤–éƒ¨é—œé–‰ä¸‹æ‹‰é¸å–®å’Œæ¨¡æ…‹è¦–çª—
        document.addEventListener('click', function(event) {
            // è™•ç†ä¸‹æ‹‰é¸å–®
            const dropdown = document.getElementById('exportDropdown');
            const button = event.target.closest('.btn-dropdown');
            
            if (!button && dropdown && dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
            }
            
            // è™•ç†æ¨¡æ…‹è¦–çª—
            const modal = document.getElementById('editModal');
            if (event.target === modal) {
                closeEditModal();
            }
        });

        // é é¢é—œé–‰å‰å­˜æª”
        window.addEventListener('beforeunload', function() {
            if (currentUser && artworks.length > 0) {
                CloudStorage.saveUserData(currentUser.id, artworks);
            }
        });

        // é é¢è¼‰å…¥æ™‚éš±è—è¼‰å…¥å™¨
        window.addEventListener('load', function() {
            hideLoading();
        });
    </script>
</body>
</html>